(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8668],{7351:function(e,s,t){Promise.resolve().then(t.bind(t,6352))},9763:function(e,s,t){"use strict";t.d(s,{Z:function(){return i}});var a=t(2265),r={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};let l=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),i=(e,s)=>{let t=(0,a.forwardRef)((t,i)=>{let{color:c="currentColor",size:d=24,strokeWidth:n=2,absoluteStrokeWidth:x,children:m,...h}=t;return(0,a.createElement)("svg",{ref:i,...r,width:d,height:d,stroke:c,strokeWidth:x?24*Number(n)/Number(d):n,className:"lucide lucide-".concat(l(e)),...h},[...s.map(e=>{let[s,t]=e;return(0,a.createElement)(s,t)}),...(Array.isArray(m)?m:[m])||[]])});return t.displayName="".concat(e),t}},1047:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Calendar",[["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",ry:"2",key:"eu3xkr"}],["line",{x1:"16",x2:"16",y1:"2",y2:"6",key:"m3sa8f"}],["line",{x1:"8",x2:"8",y1:"2",y2:"6",key:"18kwsl"}],["line",{x1:"3",x2:"21",y1:"10",y2:"10",key:"xt86sb"}]])},2208:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},9202:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Globe",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 2a14.5 14.5 0 0 0 0 20 14.5 14.5 0 0 0 0-20",key:"13o1zl"}],["path",{d:"M2 12h20",key:"9i4pu4"}]])},7168:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]])},525:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]])},5805:function(e,s,t){"use strict";t.d(s,{Z:function(){return a}});let a=(0,t(9763).Z)("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]])},6352:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return y}});var a=t(7437),r=t(2265),l=t(9763);let i=(0,l.Z)("Smartphone",[["rect",{width:"14",height:"20",x:"5",y:"2",rx:"2",ry:"2",key:"1yt0o3"}],["path",{d:"M12 18h.01",key:"mhygvu"}]]),c=(0,l.Z)("Tablet",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["line",{x1:"12",x2:"12.01",y1:"18",y2:"18",key:"1dp563"}]]),d=(0,l.Z)("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);var n=t(7168),x=t(2208),m=t(5805),h=t(1047),o=t(525),u=t(9202);function y(){let[e,s]=(0,r.useState)(null),[t,l]=(0,r.useState)(!0),[y,p]=(0,r.useState)(7),g=async()=>{l(!0);try{let e=window.location.pathname.startsWith("/ski")?"/ski":"",t=await fetch("".concat(e,"/api/analytics/stats?days=").concat(y)),a=await t.json();s(a)}catch(e){}finally{l(!1)}};(0,r.useEffect)(()=>{g()},[y]);let j=e=>{switch(e){case"mobile":return(0,a.jsx)(i,{className:"h-4 w-4"});case"tablet":return(0,a.jsx)(c,{className:"h-4 w-4"});default:return(0,a.jsx)(d,{className:"h-4 w-4"})}},N=e=>e?e<60?"".concat(e,"秒"):"".concat(Math.floor(e/60),"分").concat(e%60,"秒"):"-";return t||!e?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)(n.Z,{className:"h-8 w-8 animate-spin text-blue-600 mx-auto mb-2"}),(0,a.jsx)("p",{className:"text-gray-600",children:"加载统计数据..."})]})}):e.summary?(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 py-8",children:(0,a.jsxs)("div",{className:"max-w-7xl mx-auto px-4",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between mb-8",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"访问统计"}),(0,a.jsx)("p",{className:"text-gray-500 text-sm mt-1",children:"网站访问数据分析（仅管理员可见）"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-4",children:[(0,a.jsxs)("select",{value:y,onChange:e=>p(parseInt(e.target.value)),className:"px-3 py-2 border border-gray-300 rounded-lg text-sm",children:[(0,a.jsx)("option",{value:"1",children:"今天"}),(0,a.jsx)("option",{value:"7",children:"最近7天"}),(0,a.jsx)("option",{value:"30",children:"最近30天"}),(0,a.jsx)("option",{value:"90",children:"最近90天"})]}),(0,a.jsxs)("button",{onClick:g,disabled:t,className:"flex items-center gap-2 px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 disabled:opacity-50",children:[(0,a.jsx)(n.Z,{className:"h-4 w-4 ".concat(t?"animate-spin":"")}),"刷新"]})]})]}),e&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-blue-100 rounded-lg",children:(0,a.jsx)(x.Z,{className:"h-5 w-5 text-blue-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"总访问量"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.summary.totalVisits})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-green-100 rounded-lg",children:(0,a.jsx)(m.Z,{className:"h-5 w-5 text-green-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"独立访客"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.summary.uniqueVisitors})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-orange-100 rounded-lg",children:(0,a.jsx)(h.Z,{className:"h-5 w-5 text-orange-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"今日访问"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:e.summary.todayVisits})]})]})}),(0,a.jsx)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[(0,a.jsx)("div",{className:"p-2 bg-purple-100 rounded-lg",children:(0,a.jsx)(o.Z,{className:"h-5 w-5 text-purple-600"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-sm text-gray-500",children:"日均访问"}),(0,a.jsx)("p",{className:"text-2xl font-bold text-gray-900",children:y>0?Math.round(e.summary.totalVisits/y):0})]})]})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"设备类型"}),(0,a.jsx)("div",{className:"space-y-3",children:e.deviceStats.map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[j(s.type),(0,a.jsx)("span",{className:"text-sm text-gray-600 capitalize",children:s.type||"未知"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:"".concat(s.count/e.summary.totalVisits*100,"%")}})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900 w-12 text-right",children:s.count})]})]},s.type))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"浏览器"}),(0,a.jsx)("div",{className:"space-y-3",children:e.browserStats.slice(0,5).map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(u.Z,{className:"h-4 w-4 text-gray-400"}),(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s.browser||"未知"})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-green-600 h-2 rounded-full",style:{width:"".concat(s.count/e.summary.totalVisits*100,"%")}})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900 w-12 text-right",children:s.count})]})]},s.browser))})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"操作系统"}),(0,a.jsx)("div",{className:"space-y-3",children:e.osStats.slice(0,5).map(s=>(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("span",{className:"text-sm text-gray-600",children:s.os||"未知"}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)("div",{className:"w-24 bg-gray-200 rounded-full h-2",children:(0,a.jsx)("div",{className:"bg-orange-600 h-2 rounded-full",style:{width:"".concat(s.count/e.summary.totalVisits*100,"%")}})}),(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900 w-12 text-right",children:s.count})]})]},s.os))})]})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100 mb-8",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"热门页面"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-sm text-gray-500 border-b",children:[(0,a.jsx)("th",{className:"pb-3 font-medium",children:"页面路径"}),(0,a.jsx)("th",{className:"pb-3 font-medium text-right",children:"访问量"}),(0,a.jsx)("th",{className:"pb-3 font-medium text-right",children:"占比"})]})}),(0,a.jsx)("tbody",{children:e.pageStats.map((s,t)=>(0,a.jsxs)("tr",{className:"border-b border-gray-50",children:[(0,a.jsx)("td",{className:"py-3",children:(0,a.jsx)("span",{className:"text-sm text-gray-900",children:s.path})}),(0,a.jsx)("td",{className:"py-3 text-right",children:(0,a.jsx)("span",{className:"text-sm font-medium text-gray-900",children:s.count})}),(0,a.jsx)("td",{className:"py-3 text-right",children:(0,a.jsxs)("span",{className:"text-sm text-gray-500",children:[(s.count/e.summary.totalVisits*100).toFixed(1),"%"]})})]},s.path))})]})})]}),(0,a.jsxs)("div",{className:"bg-white rounded-xl p-6 shadow-sm border border-gray-100",children:[(0,a.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"最近访问记录"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{className:"text-left text-sm text-gray-500 border-b",children:[(0,a.jsx)("th",{className:"pb-3 font-medium",children:"时间"}),(0,a.jsx)("th",{className:"pb-3 font-medium",children:"页面"}),(0,a.jsx)("th",{className:"pb-3 font-medium",children:"设备"}),(0,a.jsx)("th",{className:"pb-3 font-medium",children:"浏览器"}),(0,a.jsx)("th",{className:"pb-3 font-medium",children:"系统"}),(0,a.jsx)("th",{className:"pb-3 font-medium",children:"停留"}),(0,a.jsx)("th",{className:"pb-3 font-medium",children:"IP"})]})}),(0,a.jsx)("tbody",{children:e.recentVisits.map(e=>(0,a.jsxs)("tr",{className:"border-b border-gray-50 text-sm",children:[(0,a.jsx)("td",{className:"py-2 text-gray-500",children:new Date(e.visitedAt).toLocaleString("zh-CN")}),(0,a.jsx)("td",{className:"py-2 text-gray-900 max-w-[200px] truncate",children:e.path}),(0,a.jsx)("td",{className:"py-2",children:(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[j(e.deviceType||""),(0,a.jsx)("span",{className:"capitalize",children:e.deviceType||"-"})]})}),(0,a.jsx)("td",{className:"py-2 text-gray-600",children:e.browser||"-"}),(0,a.jsx)("td",{className:"py-2 text-gray-600",children:e.os||"-"}),(0,a.jsx)("td",{className:"py-2 text-gray-600",children:N(e.duration)}),(0,a.jsx)("td",{className:"py-2 text-gray-400 font-mono text-xs",children:e.ip||"-"})]},e.id))})]})})]})]})]})}):(0,a.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("p",{className:"text-red-600",children:"加载数据失败，请刷新重试"}),(0,a.jsx)("button",{onClick:g,className:"mt-4 px-4 py-2 bg-blue-600 text-white rounded-lg",children:"重试"})]})})}}},function(e){e.O(0,[2971,2117,1744],function(){return e(e.s=7351)}),_N_E=e.O()}]);